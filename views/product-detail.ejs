<!DOCTYPE HTML>
<html>

<head>
  <title>Footwear - Free Bootstrap 4 Template by Colorlib</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Rokkitt:100,300,400,700" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

  <!-- Animate.css -->
  <link rel="stylesheet" href="css/animate.css">
  <!-- Icomoon Icon Fonts-->
  <link rel="stylesheet" href="css/icomoon.css">
  <!-- Ion Icon Fonts-->
  <link rel="stylesheet" href="css/ionicons.min.css">
  <!-- Bootstrap  -->
  <link rel="stylesheet" href="css/bootstrap.min.css">

  <!-- Magnific Popup -->
  <link rel="stylesheet" href="css/magnific-popup.css">

  <!-- Flexslider  -->
  <link rel="stylesheet" href="css/flexslider.css">

  <!-- Owl Carousel -->
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">

  <!-- Date Picker -->
  <link rel="stylesheet" href="css/bootstrap-datepicker.css">
  <!-- Flaticons  -->
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">

  <!-- Theme style  -->
  <link rel="stylesheet" href="/css/style.css">
  <style>
    #mainImageContainer {
      position: relative;
      overflow: hidden;
    }

    #mainImage {
      transition: transform 0.2s ease;
      cursor: zoom-in;
      width: 100%;
      height: auto;
    }

    .zoomed {
      transform: scale(2);
      cursor: zoom-out;
    }

    .size-option.active {
      background-color: #0f1015;
      color: #fff;
    }
  </style>

</head>

<body>

  <!-- <div class="colorlib-loader"></div> -->
  <header>
    <div id="page">
      <nav class="colorlib-nav" role="navigation">
        <div class="top-menu">
          <div class="container">
            <div class="row">
              <div class="col-sm-7 col-md-9">
                <div id="colorlib-logo"><a href="/"><img src="../../images/Screenshot_2024-10-26_152034-removebg-preview.png" style="height:50px; width:170px"></a></div>
              </div>
              <div class="col-sm-5 col-md-3">
                <form action="#" class="search-wrap">
                  <div class="form-group">
                    <input type="search" class="form-control search" placeholder="Search">
                    <button class="btn btn-primary submit-search text-center" type="submit"><i class="icon-search"></i></button>
                  </div>
                </form>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12 text-left menu-1">
                <ul>
                  <li><a href="/">Home</a></li>
                  <li><a href="/shop">Shop</a></li>
                  <li><a href="#">About</a></li>
                  <li><a href="#">Contact</a></li>
                  <li><a href="/myaccount">My Account</a></li>

                  <% if (!user) { %>
                  <li class="cart"><a href="/login">Login / Register</a></li>
                  <% } else { %>
                  <li class="cart"><a href="/logout">Logout</a></li>
                  <% } %>

                  <li class="cart"><a href="/cart"><i class="icon-shopping-cart"></i> Cart <span id="cart-count" class="badge badge-danger"><%= cartCount %></span></a></li>
                  <li class="cart"><a href="/wishlist">Wishlist</a><span id="wishlist-count" class="badge badge-danger"><%= wishlistCount %></span></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="sale">
          <div class="container">
            <div class="row">
              <div class="col-sm-8 offset-sm-2 text-center">
                <div class="row">
                  <div class="owl-carousel2">
                    <div class="item">
                      <div class="col">
                        <h3><a href="#">20% off Almost Everything! Use Code: SAMPLE20</a></h3>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
  </header>
  <!-- breadcrumb -->
  <div class="container">
    <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg mt-2">
      <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
        Home
        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>

      <a href="/shop" class="stext-109 cl8 hov-cl1 trans-04">
        Shop
        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>

      <span class="stext-109 cl4">
        <%= product.name  %>
      </span>
    </div>
  </div>


  <div class="colorlib-product">
    <div class="container">
      <div class="row row-pb-lg product-detail-wrap">
        <div class="col-sm-8">
          <div id="carouselExample" class="carousel slide">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <div id="mainImageContainer">
                  <img id="mainImage" src="/<%= product.images[0] %>" alt="Product Image" style="height:500px; width: 730px;">
                </div>
              </div>
              <div class="carousel-item">
                <img src="/<%=product.images[1] %>" class="d-block w-100" alt="..." style="height:500px; width: 730px;">
              </div>
              <div class="carousel-item">
                <img src="/<%=product.images[2] %>" class="d-block w-100" alt="..." style="height:500px; width: 730px;">
              </div>
              <div class="carousel-item">
                <img src="/<%=product.images[3] %>" class="d-block w-100" alt="..." style="height:500px; width: 730px;">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="product-desc">
            <h3><%= product.name %></h3>
            <p class="price">
              <span>&#8377;<del><%= product.price %></del></span> <span>&#8377;<%= product.offerPrice %></span> <span class="discount">
                <%= Math.round(((product.price - product.offerPrice) / product.price) * 100) %>% Off
              </span>
            </p>
            <br>
            <div class="size-wrap">
              <div class="block-26 mb-2">
                <h4>Size</h4>
                <% product.variants.forEach((data) =>{ %>
                <ul>
                  <li><a href="#" data-size="<%=data.size %>" class="size-option"><%=data.size%></a></li>
                </ul>
                <% }) %>
              </div>
            </div>
            <div class="input-group mb-4">
              <span class="input-group-btn">
                <button type="button" class="quantity-left-minus btn" data-type="minus" data-field="" onclick="decrementQuantity()">
                  <i class="fas fa-minus"></i>
                </button>
              </span>
              <input type="number" id="quantity" name="quantity" class="form-control input-number" value="1" min="1" max="10" disabled>
              <span class="input-group-btn ml-1">
                <button type="button" class="quantity-right-plus btn" data-type="plus" data-field="" onclick="incrementQuantity()">
                  <i class="fas fa-plus"></i>
                </button>
              </span>
            </div>

            <div>
              <% if(product.totalStock>0){ %>
              <p style="color:green; font-size: 20px;">In Stock : <%= product.totalStock %></p>
              <% }else{%>
              <p style="color:red;">Out of Stock</p>
              <% } %>
            </div>

            <div class="row">
              <div class="col-sm-12 text-center d-flex">
                <button id="addToCartButton" class="btn btn-primary" data-product-id="<%= product._id %>">Add to Cart</button>
                <button id="addToWishlistButton" data-product-id="<%= product._id %>" style="background: none; border: none;">
                  <i class="bi 
    <%= isWishlisted ? 'bi-suit-heart-fill text-danger' : 'bi-suit-heart' %> 
    fs-3">
                  </i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-md-12 pills">
              <div class="bd-example bd-example-tabs">
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="pills-description-tab" data-toggle="pill" href="#pills-description" role="tab" aria-controls="pills-description" aria-expanded="true">Description</a>
                  </li>
                </ul>

                <div class="tab-content" id="pills-tabContent">
                  <div class="tab-pane border fade show active" id="pills-description" role="tabpanel" aria-labelledby="pills-description-tab">
                    <p>
                      <%=product.description %>
                    </p>
                  </div>
                  <div class="container-fluid py-5">
                    <div class="text-center mb-4">
                      <h2 class="section-title px-5"><span class="px-2">You May Also Like</span></h2>
                    </div>

                    <div class="row row-pb-md">
                      <% relatedProducts.forEach(element => { %>
                      <div class="col-lg-3 mb-4 text-center">
                        <div class="product-entry border" id="mainImageContainer">
                          <a href="/productdetail/<%= element._id %>" class="prod-img">
                            <img id="mainImage" src="/<%= element.images[0] %>" class="img-fluid" alt="Product Image" style="height: 250px;">
                          </a>
                          <div class="desc">
                            <h2><a href="#"><%= element.name %></a></h2>
                            <span class="price"><%= element.offerPrice %></span>
                          </div>
                        </div>
                      </div>
                      <% }) %>
                    </div>
                  </div>
                  <%- include('./layouts/footer') %>

                  <div class="gototop js-top">
                    <a href="#" class="js-gotop"><i class="ion-ios-arrow-up"></i></a>
                  </div>

                  <!-- jQuery -->
                  <script src="js/jquery.min.js"></script>
                  <!-- popper -->
                  <script src="js/popper.min.js"></script>
                  <!-- bootstrap 4.1 -->
                  <script src="js/bootstrap.min.js"></script>
                  <!-- jQuery easing -->
                  <script src="js/jquery.easing.1.3.js"></script>
                  <!-- Waypoints -->
                  <script src="js/jquery.waypoints.min.js"></script>
                  <!-- Flexslider -->
                  <script src="js/jquery.flexslider-min.js"></script>
                  <!-- Owl carousel -->
                  <script src="js/owl.carousel.min.js"></script>
                  <!-- Magnific Popup -->
                  <script src="js/jquery.magnific-popup.min.js"></script>
                  <script src="js/magnific-popup-options.js"></script>
                  <!-- Date Picker -->
                  <script src="js/bootstrap-datepicker.js"></script>
                  <!-- Stellar Parallax -->
                  <script src="js/jquery.stellar.min.js"></script>
                  <!-- Main -->
                  <script src="js/main.js"></script>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
                  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
                  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


                  <script>
                    document.addEventListener("DOMContentLoaded", () => {
                      const sizeOptions = document.querySelectorAll(".size-option");

                      sizeOptions.forEach(option => {
                        option.addEventListener("click", (e) => {
                          e.preventDefault();
                          sizeOptions.forEach(opt => opt.classList.remove("active"));
                          option.classList.add("active");
                        });
                      });
                    });
                  </script>

                  <script>
                    let selectedSize = null;

                    const sizeOptions = document.querySelectorAll('.size-option');
                    sizeOptions.forEach(option => {
                      option.addEventListener('click', function(event) {
                        event.preventDefault();
                        selectedSize = event.currentTarget.textContent

                      });
                    });

                    document.getElementById("addToCartButton").addEventListener("click", async (e) => {
                      e.preventDefault();

                      if (!selectedSize) {
                        Swal.fire({
                          text: "please select a size to proceed",
                          icon: "error",
                        })
                        return;
                      }
                      let button = document.getElementById("addToCartButton")
                      button = e.currentTarget
                      let productId = button.getAttribute('data-product-id')
                      let quantity = parseInt(document.getElementById("quantity").value);

                      try {
                        const response = await fetch('/addtocart', {
                          method: 'POST',
                          headers: {
                            'Content-Type': 'application/json',
                          },
                          body: JSON.stringify({
                            productId,
                            quantity,
                            size: selectedSize
                          }),
                        });

                        const data = await response.json();

                        if (data.success) {
                          Swal.fire({
                            text: data.message,
                            icon: "success",
                          })
                        } else {
                          Swal.fire({
                            text: data.message,
                            icon: 'error',
                          })
                        }

                      } catch (error) {
                        console.error('Error:', error);
                        Swal.fire({
                          text: 'An error occurred while adding to cart',
                          icon: 'error',
                        })
                      }
                    })



                    document.getElementById("addToWishlistButton").addEventListener("click", async (e) => {
                      e.preventDefault();

                      if (!selectedSize) {
                        Swal.fire({
                          text: "Please select a size to proceed",
                          icon: "error",
                        });
                        return;
                      }
                      let button = document.getElementById("addToWishlistButton")
                      const icon = button.querySelector("i");
                      let productId = button.getAttribute('data-product-id')

                      if (icon.classList.contains("bi-suit-heart-fill")) {
                        Swal.fire({
                          text: "Already in wishlist",
                          icon: "info",
                        });
                        return;
                      }

                      try {
                        const response = await fetch('/wishlist/add', {
                          method: 'POST',
                          headers: {
                            'Content-Type': 'application/json',
                          },
                          body: JSON.stringify({
                            productId,
                            size: selectedSize
                          })
                        });

                        const result = await response.json();
                        if (result.success) {
                          Swal.fire({
                            text: result.message,
                            icon: 'success',
                          })
                          icon.classList.remove("bi-suit-heart");
                          icon.classList.add("bi-suit-heart-fill");
                          icon.style.color = "red";
                        } else {
                          Swal.fire({
                            text: result.message,
                            icon: 'error',
                          })
                        }
                      } catch (error) {
                        console.error('Error adding to wishlist:', error);
                        alert('An error occurred while adding to the wishlist.');
                      }
                    });
                  </script>

                  <script>
                    function incrementQuantity() {
                      const quantityInput = document.getElementById("quantity");
                      let quantity = parseInt(quantityInput.value);
                      if (quantity < 10) {
                        quantityInput.value = quantity + 1;
                      }
                    }

                    function decrementQuantity() {
                      const quantityInput = document.getElementById("quantity");
                      let quantity = parseInt(quantityInput.value);
                      if (quantity > 1) {
                        quantityInput.value = quantity - 1;
                      }
                    }
                  </script>
                  <script>
                    document.addEventListener('DOMContentLoaded', () => {
                      const mainImageContainer = document.getElementById('mainImageContainer');
                      const mainImage = document.getElementById('mainImage');
                      const carouselImages = document.querySelectorAll('.carousel-image');

                      carouselImages.forEach(image => {
                        image.addEventListener('click', () => {
                          const newSrc = image.getAttribute('data-imgbigurl');

                          mainImage.src = newSrc;
                        });
                      });

                      mainImageContainer.addEventListener('mouseenter', () => {
                        mainImage.classList.add('zoomed');
                      });

                      mainImageContainer.addEventListener('mouseleave', () => {
                        mainImage.classList.remove('zoomed');
                      });

                      mainImageContainer.addEventListener('mousemove', (e) => {
                        const containerRect = mainImageContainer.getBoundingClientRect();
                        const offsetX = e.clientX - containerRect.left;
                        const offsetY = e.clientY - containerRect.top;

                        const xPercent = (offsetX / containerRect.width) * 100;
                        const yPercent = (offsetY / containerRect.height) * 100;

                        mainImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
                      });
                    });
                  </script>
</body>

</html>